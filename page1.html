<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…©ä½æ•¸é™¤ä»¥ä¸€ä½æ•¸ç·´ç¿’</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¨­å®š Tailwind é…ç½®å’Œ Inter å­—é«” -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* æ·ºè—è‰²èƒŒæ™¯ */
        }
        /* è‡ªå®šç¾©æ¨£å¼ä»¥ç²å¾—æ›´å¥½çš„è¦–è¦ºæ•ˆæœ */
        .container-card {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 5px 15px -5px rgba(0, 0, 0, 0.04);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <!-- ä¸»æ‡‰ç”¨ç¨‹å¼å¡ç‰‡ -->
    <div id="app" class="container-card w-full max-w-lg bg-white p-6 md:p-10 rounded-xl">
        <h1 class="text-3xl md:text-4xl font-extrabold text-indigo-700 mb-6 text-center">
            å…©ä½æ•¸é™¤æ³•å¤§æŒ‘æˆ°
        </h1>
        <p class="text-center text-gray-600 mb-8">
            è«‹è¨ˆç®—å‡ºä¸‹é¢çš„é™¤æ³•é¡Œç›®çš„å•†ï¼ˆQuotientï¼‰å’Œé¤˜æ•¸ï¼ˆRemainderï¼‰ã€‚
        </p>

        <!-- é¡¯ç¤ºé¡Œç›® -->
        <div id="problemDisplay" class="text-5xl font-mono font-bold text-center text-gray-800 mb-8 p-4 bg-yellow-50 rounded-lg border-2 border-yellow-200">
            <!-- é¡Œç›®å°‡ç”± JavaScript å¡«å…… -->
            <span id="dividend">--</span> Ã· <span id="divisor">--</span>
        </div>

        <!-- è¼¸å…¥å€åŸŸ -->
        <div class="space-y-6">
            <!-- å•† (Quotient) è¼¸å…¥ -->
            <div class="flex flex-col sm:flex-row sm:items-center">
                <label for="quotientInput" class="w-full sm:w-1/3 text-lg font-semibold text-gray-700 mb-2 sm:mb-0">
                    å•† (Quotient):
                </label>
                <input type="number" id="quotientInput" placeholder="è¼¸å…¥å•†"
                       class="w-full sm:w-2/3 p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:ring-indigo-500 transition duration-150"
                       min="0" required>
            </div>

            <!-- é¤˜æ•¸ (Remainder) è¼¸å…¥ -->
            <div class="flex flex-col sm:flex-row sm:items-center">
                <label for="remainderInput" class="w-full sm:w-1/3 text-lg font-semibold text-gray-700 mb-2 sm:mb-0">
                    é¤˜æ•¸ (Remainder):
                </label>
                <input type="number" id="remainderInput" placeholder="è¼¸å…¥é¤˜æ•¸"
                       class="w-full sm:w-2/3 p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:ring-indigo-500 transition duration-150"
                       min="0" required>
            </div>

            <!-- æª¢æŸ¥æŒ‰éˆ• -->
            <button id="checkButton" onclick="checkAnswer()"
                    class="w-full py-3 bg-indigo-600 text-white text-xl font-bold rounded-lg shadow-lg hover:bg-indigo-700 transition duration-200 ease-in-out transform hover:scale-[1.01] active:scale-95 disabled:opacity-50 mt-6">
                æª¢æŸ¥ç­”æ¡ˆ
            </button>
            
            <!-- ä¸‹ä¸€é¡ŒæŒ‰éˆ• (åˆå§‹éš±è—) -->
            <button id="nextButton" onclick="nextProblem()"
                    class="w-full py-3 bg-emerald-500 text-white text-xl font-bold rounded-lg shadow-lg hover:bg-emerald-600 transition duration-200 ease-in-out transform hover:scale-[1.01] active:scale-95 hidden">
                ä¸‹ä¸€é¡Œ
            </button>
        </div>

        <!-- çµæœè¨Šæ¯å€åŸŸ (ä½¿ç”¨è‡ªå®šç¾© Modal æ›¿ä»£ alert) -->
        <div id="messageContainer" class="fixed inset-0 bg-gray-900 bg-opacity-50 backdrop-blur-sm z-50 flex items-center justify-center hidden" onclick="hideMessage()">
            <div id="messageBox" class="bg-white p-8 rounded-xl max-w-sm w-11/12 text-center transform transition-all duration-300 scale-95" onclick="event.stopPropagation()">
                <h3 id="messageTitle" class="text-2xl font-bold mb-3">çµæœ</h3>
                <p id="messageText" class="text-gray-700 mb-5">è¨Šæ¯å…§å®¹</p>
                <button onclick="hideMessage()" class="bg-indigo-500 text-white px-4 py-2 rounded-lg hover:bg-indigo-600 transition">
                    ç¢ºå®š
                </button>
            </div>
        </div>

    </div>

    <!-- JavaScript é‚è¼¯ -->
    <script type="module">
        // Firebase ç›¸é—œï¼ˆæ¨™æº–åˆå§‹åŒ–ï¼Œé›–ç„¶æ­¤æ‡‰ç”¨ç¨‹å¼ä¸ä½¿ç”¨è³‡æ–™åº«ï¼Œä½†ä¿ç•™çµæ§‹ï¼‰
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth;

        // --- Firebase/Auth Initialization (Standard Boilerplate) ---
        const initializeFirebase = async () => {
            if (firebaseConfig) {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                try {
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                        console.log("Signed in with custom token.");
                    } else {
                        await signInAnonymously(auth);
                        console.log("Signed in anonymously.");
                    }
                } catch (error) {
                    console.error("Firebase sign-in failed:", error);
                }
            } else {
                console.warn("Firebase config is missing. Application will run without authentication/database features.");
            }
        };

        // --- Division Game Logic ---
        let currentProblem = {
            dividend: 0, // è¢«é™¤æ•¸
            divisor: 0,  // é™¤æ•¸
            quotient: 0, // å•† (æ­£ç¢ºç­”æ¡ˆ)
            remainder: 0 // é¤˜æ•¸ (æ­£ç¢ºç­”æ¡ˆ)
        };

        // DOM å…ƒç´ å¼•ç”¨
        const dividendEl = document.getElementById('dividend');
        const divisorEl = document.getElementById('divisor');
        const quotientInput = document.getElementById('quotientInput');
        const remainderInput = document.getElementById('remainderInput');
        const checkButton = document.getElementById('checkButton');
        const nextButton = document.getElementById('nextButton');
        const messageContainer = document.getElementById('messageContainer');
        const messageTitle = document.getElementById('messageTitle');
        const messageText = document.getElementById('messageText');
        const messageBox = document.getElementById('messageBox');
        
        /**
         * éš¨æ©Ÿç”Ÿæˆä¸€å€‹å…©ä½æ•¸é™¤ä»¥ä¸€ä½æ•¸çš„é¡Œç›®ã€‚
         * ç¢ºä¿é™¤æ•¸åœ¨ 2 åˆ° 9 ä¹‹é–“ï¼Œè¢«é™¤æ•¸åœ¨ 10 åˆ° 99 ä¹‹é–“ã€‚
         */
        function generateProblem() {
            // è¢«é™¤æ•¸ (Dividend): 10 - 99 (å…©ä½æ•¸)
            let dividend = Math.floor(Math.random() * 90) + 10;
            // é™¤æ•¸ (Divisor): 2 - 9 (ä¸€ä½æ•¸, æ’é™¤ 0 å’Œ 1)
            let divisor = Math.floor(Math.random() * 8) + 2;

            // è¨ˆç®—æ­£ç¢ºçš„å•†å’Œé¤˜æ•¸
            let quotient = Math.floor(dividend / divisor);
            let remainder = dividend % divisor;

            currentProblem = { dividend, divisor, quotient, remainder };

            // æ›´æ–° UI
            dividendEl.textContent = dividend;
            divisorEl.textContent = divisor;
            quotientInput.value = '';
            remainderInput.value = '';
            
            // é‡ç½®æŒ‰éˆ•ç‹€æ…‹
            checkButton.classList.remove('hidden');
            nextButton.classList.add('hidden');
            quotientInput.disabled = false;
            remainderInput.disabled = false;
            
            // è®“è¼¸å…¥æ¡†è‡ªå‹•èšç„¦
            quotientInput.focus();
        }

        /**
         * æª¢æŸ¥ä½¿ç”¨è€…è¼¸å…¥çš„ç­”æ¡ˆæ˜¯å¦æ­£ç¢ºã€‚
         */
        window.checkAnswer = function() {
            const userQuotient = parseInt(quotientInput.value, 10);
            const userRemainder = parseInt(remainderInput.value, 10);

            // æª¢æŸ¥è¼¸å…¥æ˜¯å¦ç‚ºæœ‰æ•ˆæ•¸å­—
            if (isNaN(userQuotient) || isNaN(userRemainder)) {
                showMessage('éŒ¯èª¤', 'è«‹ç¢ºä¿å•†å’Œé¤˜æ•¸éƒ½è¼¸å…¥äº†æ•¸å­—ï¼', 'text-red-600');
                return;
            }

            const { dividend, divisor, quotient, remainder } = currentProblem;
            
            // é©—è­‰é™¤æ³•å…¬å¼ï¼š è¢«é™¤æ•¸ = å•† * é™¤æ•¸ + é¤˜æ•¸
            const isValidEquation = (userQuotient * divisor + userRemainder) === dividend;
            // é©—è­‰é¤˜æ•¸æ€§è³ªï¼š é¤˜æ•¸ < é™¤æ•¸
            const isValidRemainder = userRemainder < divisor && userRemainder >= 0;

            if (userQuotient === quotient && userRemainder === remainder && isValidEquation && isValidRemainder) {
                // ç­”æ¡ˆå®Œå…¨æ­£ç¢º
                showMessage(
                    'ğŸ‰ å¤ªæ£’äº†! ç­”å°äº†! ğŸ‰',
                    `æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${dividend} Ã· ${divisor} = ${quotient} é¤˜ ${remainder}ã€‚ä½ åšå¾—éå¸¸å¥½ï¼`,
                    'text-green-600'
                );
                // ç¦ç”¨è¼¸å…¥ï¼Œé¡¯ç¤ºä¸‹ä¸€é¡ŒæŒ‰éˆ•
                quotientInput.disabled = true;
                remainderInput.disabled = true;
                checkButton.classList.add('hidden');
                nextButton.classList.remove('hidden');
                nextButton.focus(); // è®“ä¸‹ä¸€é¡ŒæŒ‰éˆ•èšç„¦
            } else {
                let feedbackText = `ç­”æ¡ˆä¸æ­£ç¢ºï¼Œè«‹å†è©¦ä¸€æ¬¡ï¼`;
                if (!isValidRemainder) {
                    feedbackText += `<br>æé†’ï¼šé¤˜æ•¸ï¼ˆ${userRemainder}ï¼‰å¿…é ˆå°æ–¼é™¤æ•¸ï¼ˆ${divisor}ï¼‰ã€‚`;
                } else if (!isValidEquation) {
                    feedbackText += `<br>æé†’ï¼šè«‹æª¢æŸ¥å…¬å¼ï¼šå•† Ã— é™¤æ•¸ + é¤˜æ•¸ = è¢«é™¤æ•¸ã€‚`;
                }
                
                showMessage(
                    'ğŸ§ å†è©¦ä¸€æ¬¡',
                    feedbackText,
                    'text-red-600'
                );
            }
        }

        /**
         * é€²å…¥ä¸‹ä¸€é¡Œã€‚
         */
        window.nextProblem = function() {
            generateProblem();
        }

        /**
         * é¡¯ç¤ºè‡ªå®šç¾©è¨Šæ¯æ¡†ã€‚
         */
        function showMessage(title, text, titleColorClass = 'text-indigo-700') {
            messageTitle.textContent = title;
            messageTitle.className = `text-2xl font-bold mb-3 ${titleColorClass}`;
            messageText.innerHTML = text; // ä½¿ç”¨ innerHTML å…è¨± <br>
            messageContainer.classList.remove('hidden');
            // æ·»åŠ å‹•ç•«æ•ˆæœ
            setTimeout(() => {
                messageBox.classList.remove('scale-95');
                messageBox.classList.add('scale-100');
            }, 10);
        }

        /**
         * éš±è—è‡ªå®šç¾©è¨Šæ¯æ¡†ã€‚
         */
        window.hideMessage = function() {
            messageBox.classList.remove('scale-100');
            messageBox.classList.add('scale-95');
            setTimeout(() => {
                messageContainer.classList.add('hidden');
                // éš±è—å¾Œå¦‚æœä¸‹ä¸€é¡ŒæŒ‰éˆ•å¯è¦‹ï¼Œå‰‡é‡æ–°èšç„¦åˆ°å®ƒ
                if (!nextButton.classList.contains('hidden')) {
                     nextButton.focus();
                } else {
                    quotientInput.focus();
                }
            }, 300);
        }

        // ç›£è½ Enter éµï¼ŒæŒ‰ä¸‹å¾ŒåŸ·è¡Œ checkAnswer
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                if (!messageContainer.classList.contains('hidden')) {
                    // å¦‚æœè¨Šæ¯æ¡†å½ˆå‡ºï¼ŒEnter éµåŸ·è¡Œé—œé–‰
                    hideMessage();
                    return;
                }
                
                if (!checkButton.classList.contains('hidden') && !checkButton.disabled) {
                    // å¦‚æœæª¢æŸ¥æŒ‰éˆ•å¯è¦‹ï¼ŒEnter éµåŸ·è¡Œæª¢æŸ¥
                    checkAnswer();
                } else if (!nextButton.classList.contains('hidden')) {
                    // å¦‚æœä¸‹ä¸€é¡ŒæŒ‰éˆ•å¯è¦‹ï¼ŒEnter éµåŸ·è¡Œä¸‹ä¸€é¡Œ
                    nextProblem();
                }
            }
        });

        // æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•é»
        window.onload = function() {
            initializeFirebase();
            generateProblem();
        };

    </script>
</body>
</html>
